<!doctype html>
<html lang="eo">

<head>
  <meta charset="utf-8">
  <title>
  Vortejo/Vortaro/Kontrolilo
</title>

  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="/vortejo/main.min.9c66deaeb228a124f9336c58081722a322330168788f1fae0e48fc6ef6a7d4d4.css" integrity="sha256-nGberrIooST5M2xYCBcioyIzAWh4jx&#43;uDkj8bvan1NQ=">

  <link rel="icon" href="icon.png">
  <script defer src="/vortejo/main.min.72da15ee44001133496bbea8fd5426fe35a4ff083442926b89e5098288db4fe3.js" integrity="sha256-ctoV7kQAETNJa76o/VQm/jWk/wg0QpJrieUJgojbT&#43;M="></script>

</head>

<body class="">

  <div id="ŝirmilo" hidden>
    <div class="montrilo">
      testset
    </div>
  </div>

  
    <header>
      <h1>
        <a href="/vortejo">
          <span>Vortejo</span>
        </a>
      </h1>
    </header>
  

  
<main aria-role="main">
  <h1 id="kontrolilo">Kontrolilo</h1>
<p>Eta kaj iom stulta ilo por kontroli ĉu teksto enhavas neoficialajn vortojn. Enmetu la tekston sube, premu la &ldquo;ek&rdquo; butonon. La rezulto estas la teksto, kun la vortoj partigitaj en subvortojn, laŭ la radikoj de la vortaro.</p>
<p>Estas ofte multaj kieloj laŭ kiu oni povas partigi vorton, inkluzive de tiuj kiuj ne estas tute laŭregulaj, do la sistemo trovas ĉiujn kaj tiam elektis la plej verŝajne. La nombro post ĉiu vorto estas la kiomo de eblaj partigoj - alklaku vorton por vidi tiujn. Eblas ke la elektita ne estas la intenca.</p>
<p>Vorto kun oranĝkolora bordo estas nekomprenebla uzanta la vortaro.</p>

<div class="kontrolilo">

  <div class="stato">
    pretiĝanta
  </div>

  <h2>En</h2>

  <form class="formo" hidden>
    <textarea name="teksto" placeholder="enigi tekston ĉie tie"></textarea>
    <button type="submit">ek</button>
    <button type="button" name="mp">malplenigi</button>
  </form>

  <h2>El</h2>

  <div class="rezulto" hidden>
  </div>

  <div class="lavorto" hidden>
  </div>

</div>

<script defer>
(function() {
  let dividŜablono = /[^A-Za-zĉĝĥĵŝŭĈĜĤĴŜŬ]/

  let radikoj = null

  let e0 = document.querySelector('.kontrolilo')
  let eS = e0.querySelector('.stato')
  let eF = e0.querySelector('form')
  let eT = eF.querySelector('[name=teksto]')
  let eR = e0.querySelector('.rezulto')
  let eM = e0.querySelector('.lavorto')

  function montruEraro(e) {
    console.log(e)
    montruTeksto(eS, 'err: ' + e)
  }

  function montruTeksto(e, t) {
    e.textContent = t
  }

  eF.addEventListener('submit', e  => {
    e.preventDefault()
    komprenuTuton(eT.value)
  })
  eF.querySelector("[name=mp]").addEventListener('click', e  => {
    eT.value = ''
  })

  function montruVorto(altj) {
    eM.removeChild(eM.firstChild)
    let l = document.createElement('ol')
    for (let a of altj) {
      let ero = document.createElement('li')
      ero.textContent = a.vorto
      if (a.eraro) {
        ero.title = a.eraro.join(', ')
      }
      l.appendChild(ero)
    }
    eM.appendChild(l)
    eM.hidden = false
    montru(eM)
  }

  function komprenuTuton(teksto) {
    eR.removeChild(eR.firstChild)

    if (!radikoj) {
      return
    }

    let e = document.createElement('div')
    for (v of teksto.split(dividŜablono)) {
      if (v.length == 0) {
        continue
      }
      let vs = document.createElement('span')
      let altj = komprenuVorton(v.toLowerCase())
      let unua = altj[0]
      vs.textContent = unua.vorto
      if (altj.length > 1) {
        vs.textContent += ` (${altj.length})`
      }
      if (unua.eraro) {
        vs.title = unua.eraro.join(', ')
        vs.classList.add('warn')
      }
      vs.addEventListener('click', () => montruVorto(altj))
      e.appendChild(vs)
      e.appendChild(document.createTextNode(' '))
    }
    eR.appendChild(e)
  }

  function komprenuVorton(teksto) {
    let vj = provuDividi(teksto)

    if (vj.length == 0) {
      return ([{
        vorto: teksto,
        eraro: [ 'ne komprenebla' ],
        poentoj: -100
      }])
    }

    let altj = vj.map((a) => {
      let pj = 0
      let l = a.length
      let eraro = []
      let estAk = false
      let estPl = false
      let tipo = null
      
      let finoj = 0
      for (let i = l-1; i >= 0; i--) {
        let ero = a[i]
        if (!ero.finaĵo) {
          break
        }
        finoj++
        if (ero.radiko === 'n') {
          if (estAk || estPl || tipo) {
            eraro.push('n ne ĉe la fino')
            pj -= 10
          } else {
            estAk = true
          }
        } else if (ero.radiko === 'j') {
          if (tipo) {
            eraro.push('j antaŭ tipo')
            pj -= 10
          } else {
            estPl = true
          }
        } else if (ero.radiko === 'a' || ero.radiko === 'o') {
          if (tipo) {
            eraro.push('duobla tipo: ' + ero.radiko)
            pj -= 10
          } else {
            tipo = ero.radiko
          }
        } else if (ero.radiko === 'e') {
          if (estAk || estPl || tipo) {
            eraro.push('e finaĵo ne ĉe la fino')
            pj -= 10
          } else {
            tipo = ero.radiko
          }
        } else if (ero.radiko === 'i' || ero.radiko === 'u' || ero.radiko === 'as' || ero.radiko === 'os' || ero.radiko === 'is' || ero.radiko === 'us') {
          if (estAk || estPl || tipo) {
            eraro.push('problema finaĵo: ' + ero.radiko)
            pj -= 10
          } else {
            tipo = 'verbo'
          }
        } else {
          console.log(ero)
        }
      }
      
      for (let i = 0; i < a.length - finoj; i++) {
        let ero = a[i]
        if (ero.litero) {
          eraro.push('uzo de liternomo: ' + ero.radiko)
          pj -= 10
        } else if (ero.radiko === 'a' || ero.radiko === 'e' || ero.radiko === 'o') {
          
        } else if (ero.finaĵo) {
          eraro.push('neatenda finaĵo en vorto: ' + ero.radiko)
          pj -= 10
        }
        if (ero.xxx) {
          eraro.push(`xxx vorto: ${ero.radiko}, vidu: ${ero.vidu}`)
        }
        if (!tipo && ero.tipo) {
          tipo = ero.tipo
        }
      }
      let lasta = a[a.length-1]
      if (!tipo && !lasta.fina) {
        eraro.push('nekonata tipo')
        pj -= 20
      }
      if (!lasta.finaĵo && !lasta.fina) {
        eraro.push('ne havas finaĵon')
        pj -= 20
      }
      if (lasta.finaĵo) {
        pj += 1
      }
      
      return {
        vorto: a.map(e => e.radiko).join('/'),
        eroj: a,
        akuzativo: estAk,
        pluralo: estPl,
        tipo: tipo,
        poentoj: pj,
        eraro: eraro.length > 0 ? eraro : null
      }
    })

    altj.sort((a, b) => {
      let d = b.poentoj - a.poentoj
      if (d) {
        return d
      }
      return a.eroj.length - b.eroj.length
    })

    return altj
  }

  function provuDividi(teksto) {
    let metejo = []
    dividu([], teksto, metejo)
    return metejo
  }

  function dividu(komenco, cetero, metejo) {
    for (let i = 1; i <= cetero.length; i++) {
      let s = cetero.slice(0, i)
      let r = radikoj.get(s)
      if (r) {
        let k = komenco.slice(0)
        k.push(r)
        let c = cetero.slice(s.length)
        if (c.length > 0) {
          dividu(k, c, metejo)
        } else {
          metejo.push(k)
        }
      }
    }
  }

  function metuRadikoj(rj) {
    let m = new Map()
    for (let e of rj) {
      if (e.fakoj.includes('litera')) {
        continue
      }
      let r = e.radiko

      let streko = r.indexOf('/')
      let dashĈeKomenco = r.startsWith('-')
      let dashĈeFino = r.endsWith('-')

      let kj = {}
      if (streko >= 0) {
        kj.radiko = r.slice(0, streko)
      } else if (dashĈeKomenco && !dashĈeFino) {
        kj.radiko = r.slice(1)
        kj.finaĵo = true
      } else if (dashĈeKomenco && dashĈeFino) {
        kj.radiko = r.slice(1).slice(0, -1)
        kj.enfikso = true
      } else {
        kj.radiko = r
        kj.fina = true
      }
      if (e.fakoj.includes('litera')) {
        kj.litero = true
      }
      if (e.fakoj.includes('pronomo') || e.fakoj.includes('tabela')) {
        kj.tipo = 'o'
      }
      if (e.fakoj.includes('xxx')) {
        kj.xxx = true
        kj.vidu = e.vidu
      }

      
      let x = m.get(kj.radiko)
      if (x) {
        for (let p in x) {
          kj[p] = x[p]
        }
      }
      m.set(kj.radiko, kj)
    }

    radikoj = m

    eF.hidden = false
    eR.hidden = false
    montruTeksto(eS, '')
  }

  const fonto = '\/vortaro'

  fetch(fonto + '/radikoj.json').
  then(
    rez => rez.json(),
    montruEraro).
  then(
    metuRadikoj,
    montruEraro)
})()
</script>



  <div class="links">
    
      <a href="/vortejo/vortaro/vortoj/">&lt; Reen</a>
    
    <a href="https://undeconstructed.github.io/vortejo/">Hejmen</a>
    
      <a href="/vortejo/vortaro/problemoj/">Antaŭen &gt;</a>
    
  </div>
</main>


  <footer>
    <span>Copyright 2020 | <a href="https://github.com/undeconstructed/">Kontakti min</a> | Vidi la <a href="/vortaro">Vortara datumaro</a> (kaj <a href="https://github.com/undeconstructed/vortaro">ĝia fonto</a>).</span>
  </footer>

</body>

</html>
